{% extends "django_tables2/table.html" %}
{% load django_tables2 i18n %}
{% block table.thead %}
    <!-- Search Bar -->
    <div>
        <input class="input input-bordered join-item"
               type="text"
               name="search"
               value="{{ request.GET.search }}"
               placeholder="Search..."
               hx-get="{% url 'table_htmx' %}"
               hx-trigger="keyup delay:500ms, changed, search"
               hx-target="div.table-container"
               hx-swap="outerHTML"
               hx-indicator=".htmx-indicator">
        <!-- Spinner -->
        <i class="mx-2 htmx-indicator fa fa-spinner fa-pulse"></i>
        <span class="loading loading-spinner text-success htmx-indicator"
              id="spinner"></span>
    </div>
    {% if table.show_header %}
        <thead>
            <tr>
                <th>
                    <div class="w-60 flex items-center gap-3.5">
                        <input type="checkbox"
                               class="checkbox" />
                        <div class="truncate w-32">
                            Rider and Trip ID
                        </div>
                    </div>
                </th>
                <td>Time</td>
                <td>
                    Pick-up Location
                </td>
                <td>
                    Drop-off Location
                </td>
                <td>
                    Driver and Trip Status
                </td>
            </tr>
        </thead>
    {% endif %}
{% endblock table.thead %}
{% block table.tbody %}
    <tbody>
        {% for row in table.rows %}
            {% with trip=row.record %}
                <tr class="hover:bg-base-200">
                    <th>
                        <div class="w-60 flex items-center gap-3">
                            <input type="checkbox"
                                   class="checkbox" />
                            <div class="avatar skeleton">
                                <div class="mask mask-squircle h-12 w-12">
                                    <img src="{{ trip.rider.account.avatar }}"
                                         alt="Rider Avatar"
                                         width="48"
                                         height="48" />
                                </div>
                            </div>
                            <div class="flex flex-col gap-1.5">
                                <div class="truncate font-medium w-32">
                                    {{ trip.rider.account.name }}
                                </div>
                                <div class="btn truncate w-32">
                                    <div class="truncate">
                                        {{ trip.id }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </th>
                    <td>
                        <div class="flex flex-col w-30">
                            <div>
                                {% if trip.datetime %}
                                    {{ trip.datetime|date:"g:i A" }}
                                {% else %}
                                    --
                                {% endif %}
                            </div>
                            <div>
                                {% if trip.datetime %}
                                    {{ trip.datetime|date:"F j, Y" }}
                                {% else %}
                                    No date
                                {% endif %}
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="w-60 overflow-hidden truncate">
                            {{ trip.origin }}
                        </div>
                    </td>
                    <td>
                        <div class="w-60 overflow-hidden truncate">
                            {{ trip.destination }}
                        </div>
                    </td>
                    <td>
                        <div class="w-50 flex items-center gap-3">
                            <div class="avatar skeleton">
                                <div class="mask mask-squircle h-12 w-12">
                                    <img src="{{ trip.driver.account.avatar }}"
                                         alt="Driver Avatar"
                                         width="48"
                                         height="48" />
                                </div>
                            </div>
                            <div class="flex flex-col gap-1.5">
                                <div class="truncate font-medium w-32">
                                    {{ trip.driver.account.name }}
                                </div>
                                {% with s=trip.status %}
                                    <div class="py-1 px-2 rounded-3xl w-fit capitalize {% if s == 'canceled' %} bg-red-300{% elif s == 'completed' %} bg-green-300 {% elif s == 'scheduled' %} bg-purple-200 {% elif s == 'in_progress' %} bg-yellow-100 {% else %} bg-base-300 {% endif %}">
                                        {{ trip.get_status_display }}
                                    </div>
                                {% endwith %}
                            </div>
                        </div>
                    </td>
                </tr>
            {% endwith %}
        {% endfor %}
    </tbody>
{% endblock table.tbody %}
{% block pagination %}
{% endblock pagination %}
