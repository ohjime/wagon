{% load tz %}
<!-- Rider Summary Component -->
<fieldset class="fieldset w-full rounded-box border border-base-300 bg-base-100 !p-4">
    <legend class="fieldset-legend text-lg">
        Rider Summary
    </legend>
    <div class="flex w-full flex-row gap-4">
        <!-- Rider Card -->
        <div class="flex h-full w-full max-w-64 flex-col justify-around gap-2 rounded-3xl bg-primary text-primary-content p-4 shadow-md">
            <!-- First Row -->
            <div class="flex w-full flex-row justify-between">
                <!-- Rider Avatar -->
                <div class="avatar">
                    <div class="h-18 w-18 rounded-full">
                        <img src="{{ rider_avatar }}"
                             alt="Rider avatar"
                             width="72"
                             height="72" />
                    </div>
                </div>
                <!-- Go to Detail Buttons -->
                <button class="btn btn-circle">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         fill="none"
                         viewBox="0 0 24 24"
                         stroke-width="1.5"
                         stroke="currentColor"
                         class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z" />
                    </svg>
                </button>
            </div>
            <!-- Second Row -->
            <div class="text-xl font-semibold">
                <!-- Rider Name -->
                {{ rider_name }}
            </div>
            <!-- Third Row -->
            <div class="-mt-3">
                <!-- Rider Email -->
                {{ rider_email }}
            </div>
            <!-- Fourth Row -->
            <div class="btn btn-secondary font-semibold btn-xs">
                <!-- Rider Phone -->
                {{ rider_phone }}
            </div>
            <!-- Fifth Row -->
            <div class="flex flex-row gap-4">
                <div class="flex flex-row gap-1">
                    <div class="text-lg">
                        {{ wheelchair_count }}
                    </div>
                    <svg xmlns="http://www.w3.org/2000/svg"
                         height="24px"
                         viewBox="0 -960 960 960"
                         width="24px"
                         fill="currentColor">
                        <path d="M480-720q-33 0-56.5-23.5T400-800q0-33 23.5-56.5T480-880q33 0 56.5 23.5T560-800q0 33-23.5 56.5T480-720ZM680-80v-200H480q-33 0-56.5-23.5T400-360v-240q0-33 23.5-56.5T480-680q24 0 41.5 10.5T559-636q55 66 99.5 90.5T760-520v80q-53 0-107-23t-93-55v138h120q33 0 56.5 23.5T760-300v220h-80Zm-280 0q-83 0-141.5-58.5T200-280q0-72 45.5-127T360-476v82q-35 14-57.5 44.5T280-280q0 50 35 85t85 35q39 0 69.5-22.5T514-240h82q-14 69-69 114.5T400-80Z" />
                    </svg>
                </div>
                <div class="flex flex-row gap-1">
                    <div class="text-lg">
                        {{ seated_count }}
                    </div>
                    <svg xmlns="http://www.w3.org/2000/svg"
                         height="24px"
                         viewBox="0 -960 960 960"
                         width="24px"
                         fill="currentColor">
                        <path d="M340-720q-33 0-56.5-23.5T260-800q0-33 23.5-56.5T340-880q33 0 56.5 23.5T420-800q0 33-23.5 56.5T340-720Zm220 560H302q-33 0-60.5-23.5T207-240l-87-440h82l88 440h270v80Zm220 80L664-280H386q-29 0-50.5-17.5T308-344l-44-214q-11-48 22.5-85t81.5-37q35 0 63.5 21t36.5 57l44 202h130q21 0 39 11t29 29l140 240-70 40Z" />
                    </svg>
                </div>
            </div>
        </div>
        <!-- Service Card -->
        <div class="flex h-fit w-full flex-col gap-2 rounded-2xl bg-base-200/30 p-4 shadow-sm">
            <label class="label">
                Trip Date and Time
            </label>
            <input type="datetime-local"
                   id="trip-date-time"
                   class="input !w-full"
                   data-raw="{{ trip_date_time }}"
                   {% if trip_date_time and trip_date_time.year %} value="{{ trip_date_time|localtime|date:'Y-m-d\\TH:i' }}" {% else %} value="" {% endif %} />
            <label class="label">
                Service Type
            </label>
            <select class="select !w-full">
                <option disabled
                        selected>
                    Select Service
                </option>
                <option selected>
                    Personal
                </option>
                <option>
                    Grey Nuns Hospital
                </option>
                <option>
                    Sturgeon Hospital
                </option>
            </select>
            <label class="label">
                Payment Method
            </label>
            <select class="select !w-full">
                <option disabled
                        selected>
                    Select Payment Method
                </option>
                <option>
                    Invoice
                </option>
                <option>
                    Credit
                </option>
                <option selected>
                    Cash
                </option>
                <option>
                    External
                </option>
            </select>
        </div>
    </div>
</fieldset>
<script>
    (function() {
        const el = document.getElementById('trip-date-time');
        if (!el) return;
        if (el.value) return; // already set by server-side formatting
        const raw = el.dataset.raw || '';
        if (!raw) return;
        // Try a few normalizations from Django's default human format to JS Date
        let s = raw.trim();
        s = s.replace(/\ba\.m\./ig, 'AM').replace(/\bp\.m\./ig, 'PM');
        s = s.replace(/\./g, ''); // remove dots in month abbreviations like "Aug."
        s = s.replace(/,\s*/g, ' '); // remove commas
        // Create date
        const d = new Date(s);
        if (isNaN(d.getTime())) return;
        const pad = (n) => String(n).padStart(2, '0');
        const yyyy = d.getFullYear();
        const mm = pad(d.getMonth() + 1);
        const dd = pad(d.getDate());
        const hh = pad(d.getHours());
        const mi = pad(d.getMinutes());
        el.value = `${yyyy}-${mm}-${dd}T${hh}:${mi}`;
    })();
</script>
