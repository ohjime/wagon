{% load django_vite %}
{% load django_htmx %}
<!DOCTYPE html>
<html lang="en">
      <head>
            <title>Dispatcher | Royal Wagon</title>
            <meta charset="UTF-8">
            <meta name="viewport"
                  content="width=device-width, initial-scale=1.0">
            <meta http-equiv="X-UA-Compatible"
                  content="ie=edge">
            <meta name="description"
                  content="A Django project using Tailwind CSS.">
            <meta name="keywords"
                  content="Django, Tailwind, CSS, Python, Web Development">
            <style>
                /* Loader base layout */
                #page-loader {
                    position: fixed;
                    inset: 0;
                    z-index: 9999;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: opacity 0.4s, background-color 0.3s, color 0.3s;
                    /* Fallback (will be immediately overridden by media queries in supporting browsers) */
                    background: #2a303c;
                    color: #d1d5db;
                }

                /* Spinner element inside loader (rotating color variant) */
                .loader {
                    --c: no-repeat linear-gradient(orange 0 0);
                    background: var(--c), var(--c), var(--c), var(--c), var(--c), var(--c),
                        var(--c), var(--c), var(--c);
                    background-size: 16px 16px;
                    animation: l32-1 1s infinite, l32-2 1s infinite;
                }

                @keyframes l32-1 {

                    0%,
                    100% {
                        width: 45px;
                        height: 45px;
                    }

                    35%,
                    65% {
                        width: 65px;
                        height: 65px;
                    }
                }

                @keyframes l32-2 {

                    0%,
                    40% {
                        background-position: 0 0, 0 50%, 0 100%, 50% 100%, 100% 100%, 100% 50%,
                            100% 0, 50% 0, 50% 50%;
                    }

                    60%,
                    100% {
                        background-position: 0 50%, 0 100%, 50% 100%, 100% 100%, 100% 50%,
                            100% 0, 50% 0, 0 0, 50% 50%;
                    }
                }

                /* Light mode (system preference) */
                @media (prefers-color-scheme: light) {
                    #page-loader {
                        background: #f3f4f6;
                        /* light gray */
                        color: #374151;
                        /* slate-700 */
                    }
                }

                /* Dark mode (system preference) */
                @media (prefers-color-scheme: dark) {
                    #page-loader {
                        background: #1f2733;
                        /* deep slate */
                        color: #d1d5db;
                        /* light gray */
                    }
                }

                /* High contrast / forced colors (optional accessibility tweak) */
                @media (forced-colors: active) {
                    #page-loader {
                        background: Canvas;
                        color: CanvasText;
                    }
                }
            </style>
            <script>
                window.addEventListener("DOMContentLoaded", function() {
                    var loader = document.getElementById("page-loader");
                    if (loader) {
                        setTimeout(function() {
                            loader.style.opacity = "0";
                            setTimeout(function() {
                                loader.style.display = "none";
                            }, 300);
                        }, 600); // Show loader for at least 1 second
                    }
                });
            </script>
            <style>
                .fade-out {
                    opacity: 0;
                    transition: opacity 0.5s ease;
                }
            </style>
            <script>
                document.querySelectorAll(".delayed-link").forEach((link) => {
                    link.addEventListener("click", function(e) {
                        e.preventDefault(); // stop the browser's immediate navigation
                        const url = this.href;

                        // Run your transition or animation
                        document.body.classList.add("fade-out");

                        // After animation ends, continue navigation
                        setTimeout(() => {
                            window.location.href = url;
                        }, 500); // match your animation duration
                    });
                });
            </script>
            {% vite_hmr_client %}
            {% vite_asset 'assets/js/main.js' %}
            {% htmx_script %}
      </head>
      <body hx-headers='{"x-csrftoken": "{{ csrf_token }}"}'
            class="flex h-screen w-screen flex-col overscroll-y-none"
            x-data="{ toggleDrawer: false, hoverDrawer: false }">
            <div id="page-loader">
                  <div class="loader"
                       role="status"
                       aria-label="Loading">
                  </div>
            </div>
            <header class="flex h-20 w-full flex-row items-center">
                  <div class="flex h-20 items-center justify-between px-2 transition-all duration-300"
                       :class="hoverDrawer || toggleDrawer ? 'w-80 min-w-80 bg-base-300' : 'w-20 min-w-20 bg-base-300'"
                       @mouseenter="hoverDrawer = true"
                       @mouseleave="hoverDrawer = false">
                        <div class="flex h-16 w-16 flex-shrink-0 items-center justify-center p-2">
                              <img src="https://images.squarespace-cdn.com/content/v1/5988cc25d7bdcee306c92cd7/1511695652838-4FFI62AXZ2HAZHSULI5D/royal_wagon_icon_qlB_icon.ico?format=2500w"
                                   alt="Royal Wagon Icon"
                                   height="64"
                                   width="64"
                                   class="h-16 w-16 object-contain" />
                        </div>
                        <div class="flex h-16 w-16 flex-shrink-0 items-center justify-center">
                              <button class="flex h-full w-full cursor-pointer items-center justify-end px-2 transition-all duration-200"
                                      @click="toggleDrawer = !toggleDrawer; if (!toggleDrawer) hoverDrawer = false"
                                      :class="hoverDrawer || toggleDrawer ? 'opacity-100' : 'opacity-0'">
                                    <svg class="rounded-lg p-0.5 transition-all duration-75"
                                         :class="toggleDrawer ? 'hover:bg-base-200 hover:text-neutral-400 text-info-content/60': 'hover:bg-base-100 hover:text-neutral-400 text-neutral-500'"
                                         xmlns="http://www.w3.org/2000/svg"
                                         height="32px"
                                         width="32px"
                                         viewBox="0 -960 960 960"
                                         width="24px"
                                         fill="currentColor">
                                          <path d="M120-240v-80h520v80H120Zm664-40L584-480l200-200 56 56-144 144 144 144-56 56ZM120-440v-80h400v80H120Zm0-200v-80h520v80H120Z" />
                                    </svg>
                              </button>
                        </div>
                  </div>
                  <div class="flex flex-col gap-0.5 px-12 py-4">
                        <div class="text-lg">
                              Trip Center
                        </div>
                        <div class="dropdown">
                              <button class="btn !rounded-2xl btn-soft btn-xs">
                                    <div class="pr-5">
                                          All Trips
                                    </div>
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         height="24px"
                                         viewBox="0 -960 960 960"
                                         width="24px">
                                          <path d="M480-360 280-560h400L480-360Z" />
                                    </svg>
                              </button>
                              <ul tabindex="0"
                                  class="dropdown-content menu z-1 w-52 rounded-box bg-base-100 p-2 shadow-sm">
                                    <li>
                                          <a>Item 1</a>
                                    </li>
                                    <li>
                                          <a>Item 2</a>
                                    </li>
                              </ul>
                        </div>
                  </div>
                  <div class="flex-1">
                  </div>
                  <div class="flex flex-row gap-4 pl-4 pr-8 pt-6">
                        <!-- Main Action -->
                        <button class="btn">
                              <svg xmlns="http://www.w3.org/2000/svg"
                                   height="24px"
                                   viewBox="0 -960 960 960"
                                   width="24px">
                                    <path d="M440-440H200v-80h240v-240h80v240h240v80H520v240h-80v-240Z" />
                              </svg>
                              New Trip
                        </button>
                        <!-- Profile Dropdown -->
                        <div class="dropdown dropdown-end">
                              <div tabindex="0"
                                   role="button"
                                   class="btn avatar btn-circle btn-ghost">
                                    <div class="w-10 rounded-full">
                                          <img alt="Tailwind CSS Navbar component"
                                               src="https://img.daisyui.com/images/stock/photo-1534528741775-53994a69daeb.webp"
                                               height="64"
                                               width="64" />
                                    </div>
                              </div>
                              <ul tabindex="0"
                                  class="dropdown-content menu z-1 mt-3 w-52 menu-sm rounded-box bg-base-100 p-2 shadow">
                                    <li>
                                          <a class="justify-between">
                                                Profile
                                                <span class="badge">New</span>
                                          </a>
                                    </li>
                                    <li>
                                          <a>Settings</a>
                                    </li>
                                    <li>
                                          <a>Logout</a>
                                    </li>
                              </ul>
                        </div>
                  </div>
            </header>
            <div class="flex h-[calc(100vh-5rem)] flex-1 flex-row">
                  <nav class="fixed top-20 bottom-0 left-0 z-10 flex flex-col items-start px-2.5 text-base-content transition-all duration-300"
                       :class="hoverDrawer || toggleDrawer ? 'w-80 bg-base-300' : 'w-20 bg-base-300'"
                       @mouseenter="hoverDrawer = true"
                       @mouseleave="hoverDrawer = false">
                        <hr class="h-0.5 min-h-0.5 mb-4 rounded-full w-full border-0"
                            :class="hoverDrawer || toggleDrawer ? 'bg-neutral-300/80' : 'bg-neutral-300/60'">
                        <ul class="flex w-full flex-auto flex-col gap-3"
                            :class="hoverDrawer || toggleDrawer ? 'text-base-content/70' : 'text-base-content/30'">
                              <li>
                                    <a hx-get="{% url 'trips_index' %}"
                                       hx-target="#content"
                                       hx-swap="innerHTML"
                                       class="cursor-pointer flex h-full items-center gap-2 rounded-lg px-2 py-1.5 transition-color duration-200 hover:bg-base-200 hover:text-base-content mx-1">
                                          <svg class="rounded-lg flex h-full flex-shrink-0 items-center justify-center"
                                               xmlns="http://www.w3.org/2000/svg"
                                               height="36px"
                                               viewBox="0 -960 960 960"
                                               width="36px"
                                               fill="currentColor">
                                                <path d="M160-80v-240h120v240H160Zm200 0v-476q-50 17-65 62.5T280-400h-80q0-128 75-204t205-76q100 0 150-49.5T680-880h80q0 88-37.5 157.5T600-624v544h-80v-240h-80v240h-80Zm120-640q-33 0-56.5-23.5T400-800q0-33 23.5-56.5T480-880q33 0 56.5 23.5T560-800q0 33-23.5 56.5T480-720Z" />
                                          </svg>
                                          <span class="flex-shrink-0 transition-opacity delay-75 duration-200 truncate"
                                                :class="hoverDrawer || toggleDrawer ? 'opacity-100 w-full' : 'opacity-0 w-0'">
                                                Trips
                                          </span>
                                    </a>
                              </li>
                              <li>
                                    <a hx-get="{% url 'riders_index' %}"
                                       hx-target="#content"
                                       hx-swap="innerHTML"
                                       class="cursor-pointer flex h-full items-center gap-2 rounded-lg px-2 py-1.5 transition-color duration-200 hover:bg-base-200 hover:text-base-content mx-1">
                                          <svg class="rounded-lg flex h-full flex-shrink-0 items-center justify-center"
                                               xmlns="http://www.w3.org/2000/svg"
                                               height="36px"
                                               viewBox="0 -960 960 960"
                                               width="36px"
                                               fill="currentColor">
                                                <path d="M320-80q-83 0-141.5-58.5T120-280q0-83 58.5-141.5T320-480v80q-50 0-85 35t-35 85q0 50 35 85t85 35q50 0 85-35t35-85h80q0 83-58.5 141.5T320-80Zm360-40v-200H440q-44 0-68-37.5t-6-78.5l74-164h-91l-24 62-77-22 28-72q9-23 29.5-35.5T350-680h208q45 0 68.5 36.5T632-566l-66 146h114q33 0 56.5 23.5T760-340v220h-80Zm-40-580q-33 0-56.5-23.5T560-780q0-33 23.5-56.5T640-860q33 0 56.5 23.5T720-780q0 33-23.5 56.5T640-700Z" />
                                          </svg>
                                          <span class="flex-shrink-0 transition-opacity delay-75 duration-200 truncate"
                                                :class="hoverDrawer || toggleDrawer ? 'opacity-100 w-full' : 'opacity-0 w-0'">
                                                Riders
                                          </span>
                                    </a>
                              </li>
                              <li>
                                    <a hx-get="{% url 'drivers_index' %}"
                                       hx-target="#content"
                                       hx-swap="innerHTML"
                                       class="cursor-pointer flex h-full items-center gap-2 rounded-lg px-2 py-1.5 transition-color duration-200 hover:bg-base-200 hover:text-base-content mx-1">
                                          <svg class="rounded-lg flex h-full flex-shrink-0 items-center justify-center"
                                               xmlns="http://www.w3.org/2000/svg"
                                               height="36px"
                                               viewBox="0 -960 960 960"
                                               width="36px"
                                               fill="currentColor">
                                                <path d="M260-720q-33 0-56.5-23.5T180-800q0-33 23.5-56.5T260-880q33 0 56.5 23.5T340-800q0 33-23.5 56.5T260-720ZM200-80v-280h-80v-240q0-33 23.5-56.5T200-680h120q33 0 56.5 23.5T400-600v78q-63 36-101.5 100T260-280q0 57 21 107.5T340-84v4H200Zm340 0q-83 0-141.5-58.5T340-280q0-67 39.5-118.5T480-470v87q-27 16-43.5 43T420-280q0 50 35 85t85 35q50 0 85-35t35-85h80q0 83-58.5 141.5T540-80Zm297-92-99-148H520v-320h80v240h182l122 184-67 44Z" />
                                          </svg>
                                          <span class="flex-shrink-0 transition-opacity delay-75 duration-200 truncate"
                                                :class="hoverDrawer || toggleDrawer ? 'opacity-100 w-full' : 'opacity-0 w-0'">
                                                Drivers
                                          </span>
                                    </a>
                              </li>
                        </ul>
                        <div class="flex flex-1">
                        </div>
                        <hr class="h-0.5 min-h-0.5 mt-2 mb-4 rounded-full w-full border-0 bg-neutral-300/60'"
                            :class="hoverDrawer || toggleDrawer ? 'bg-neutral-300/80' : 'bg-neutral-300/60'">
                        <div class="h-fit mb-4"
                             :class="hoverDrawer || toggleDrawer ? 'text-base-content/70' : 'text-base-content/30'">
                              <a href="{% url 'admin:index' %}"
                                 class="flex h-full items-center gap-2 rounded-lg px-2 py-1.5 transition-color duration-200 hover:bg-base-200 hover:text-base-content mx-1">
                                    <svg class="rounded-lg flex h-full flex-shrink-0 items-center justify-center"
                                         xmlns="http://www.w3.org/2000/svg"
                                         height="36px"
                                         viewBox="0 -960 960 960"
                                         width="36px"
                                         fill="currentColor">
                                          <path d="m370-80-16-128q-13-5-24.5-12T307-235l-119 50L78-375l103-78q-1-7-1-13.5v-27q0-6.5 1-13.5L78-585l110-190 119 50q11-8 23-15t24-12l16-128h220l16 128q13 5 24.5 12t22.5 15l119-50 110 190-103 78q1 7 1 13.5v27q0 6.5-2 13.5l103 78-110 190-118-50q-11 8-23 15t-24 12L590-80H370Zm70-80h79l14-106q31-8 57.5-23.5T639-327l99 41 39-68-86-65q5-14 7-29.5t2-31.5q0-16-2-31.5t-7-29.5l86-65-39-68-99 42q-22-23-48.5-38.5T533-694l-13-106h-79l-14 106q-31 8-57.5 23.5T321-633l-99-41-39 68 86 64q-5 15-7 30t-2 32q0 16 2 31t7 30l-86 65 39 68 99-42q22 23 48.5 38.5T427-266l13 106Zm42-180q58 0 99-41t41-99q0-58-41-99t-99-41q-59 0-99.5 41T342-480q0 58 40.5 99t99.5 41Zm-2-140Z" />
                                    </svg>
                                    <span class="flex-shrink-0 transition-opacity delay-75 duration-200 truncate"
                                          :class="hoverDrawer || toggleDrawer ? 'opacity-100 w-full' : 'opacity-0 w-0'">
                                          Admin Settings
                                    </span>
                              </a>
                        </div>
                  </nav>
                  <section id="content"
                           class="ml-20 bg-base h-full flex-1 overflow-auto pl-8 pr-4 py-4 transition-all duration-300"
                           :class="toggleDrawer ? 'ml-80' : 'ml-20'">
                        {% block content %}
                        {% endblock content %}
                  </section>
            </div>
      </body>
</html>
